"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function(t,e,r){for(var n=!0;n;){var o=t,a=e,i=r;l=c=s=void 0,n=!1,null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,a);if(void 0!==l){if("value"in l)return l.value;var s=l.get;return void 0===s?void 0:s.call(i)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;t=c,e=a,r=i,n=!0}},factory=function(t){var e=function(e){function r(t){var e=t.host,n=t.transaction_signer;_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,e),this.transaction_signer=n,this.global_nonces={}}return _inherits(r,e),_createClass(r,[{key:"send",value:function(t,e){var n=this,o=t;o instanceof Array||(o=[o]);var a=!0,i=!1,l=void 0;try{for(var s,c=o[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u=s.value;if("eth_sendTransaction"==u.method)throw new Error("HookedWeb3Provider does not support synchronous transactions. Please provide a callback.")}}catch(f){i=!0,l=f}finally{try{!a&&c["return"]&&c["return"]()}finally{if(i)throw l}}var v=function(){return console.log(t),_get(Object.getPrototypeOf(r.prototype),"send",n).call(n,t,e)};return this.rewritePayloads(0,o,{},v)}},{key:"sendAsync",value:function(t,e){var n=this,o=function(){_get(Object.getPrototypeOf(r.prototype),"sendAsync",n).call(n,t,e)},a=t;t instanceof Array||(a=[t]),this.rewritePayloads(0,a,{},o)}},{key:"rewritePayloads",value:function(e,r,n,o){var a=this;if(e>=r.length)return o();var i=r[e],l=function(t){return null!=t?o(t):a.rewritePayloads(e+1,r,n,o)};if("eth_sendTransaction"!=i.method)return l();var s=i.params[0],c=s.from;this.transaction_signer.hasAddress(c,function(e,r){if(null!=e||0==r)return l(e);var u=function(e){var r=n[c];null!=r?e(null,r):t.eth.getTransactionCount(c,"pending",function(t,r){null!=t?e(t):e(null,r.valueOf())})};u(function(e,r){if(null!=e)return o(e);var u=Math.max(r,a.global_nonces[c]||0);s.nonce=t.toHex(u),n[c]=u+1,a.global_nonces[c]=u+1,a.transaction_signer.signTransaction(s,function(t,e){return null!=t?l(t):(i.method="eth_sendRawTransaction",i.params=[e],l())})})})}}]),r}(t.providers.HttpProvider);return e},_module=_module||void 0;null!=_module?_module.exports=factory(require("web3")):window.HookedWeb3Provider=factory(web3);