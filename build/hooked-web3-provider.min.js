"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_get=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;l=s=u=void 0,r=!1,null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,i);if(void 0!==l){if("value"in l)return l.value;var u=l.get;return void 0===u?void 0:u.call(a)}var s=Object.getPrototypeOf(o);if(null===s)return void 0;e=s,t=i,n=a,r=!0}},factory=function(e){var t=function(t){function n(e){var t=e.host,r=e.transaction_signer;_classCallCheck(this,n),_get(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,t),this.transaction_signer=r,this.global_nonces={}}return _inherits(n,t),_createClass(n,[{key:"send",value:function(e){throw new Error("HookedWeb3Provider does not support synchronous methods. Please provide a callback.")}},{key:"sendAsync",value:function(e,t){var r=this,o=function(){_get(Object.getPrototypeOf(n.prototype),"sendAsync",r).call(r,e,t)},i=e;e instanceof Array||(i=[e]),this.rewritePayloads(0,i,{},o)}},{key:"rewritePayloads",value:function(t,n,r,o){var i=this;if(t>=n.length)return void o();var a=n[t],l=function(e){return null!=e?void o(e):void i.rewritePayloads(t+1,n,r,o)};if("eth_sendTransaction"!=a.method)return void l();var u=a.params[0],s=u.from;this.transaction_signer.hasAddress(s,function(t,n){if(null!=t||0==n)return void l(t);var c=function(t){var n=r[s];null!=n?t(null,n):e.eth.getTransactionCount(s,"pending",function(e,n){null!=e?t(e):t(null,n.valueOf())})};c(function(t,n){if(null!=t)return void o(t);var c=Math.max(n,i.global_nonces[s]||0);u.nonce=e.toHex(c),r[s]=c+1,i.global_nonces[s]=c+1,i.transaction_signer.signTransaction(u,function(e,t){return null!=e?void l(e):(a.method="eth_sendRawTransaction",a.params=[t],void l())})})})}}]),n}(e.providers.HttpProvider);return t},_module=_module||void 0;null!=_module?_module.exports=factory(require("web3")):window.HookedWeb3Provider=factory(web3);